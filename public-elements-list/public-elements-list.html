<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="../public-elements-card/public-elements-card.html">
<link rel="import" href="../public-elements-card-show/public-elements-card-show.html">

<dom-module id="public-elements-list">
  <template>
    <style>
      :host {
        display: block;
        position: absolute;
        overflow: auto;
        top: 0; left: 0;
        right: 0; bottom: 0;
      }
      .results {
        -moz-column-width: 14em;
        -webkit-column-width: 14em;
        column-width: 14em;
        -moz-column-gap: 1em;
        -webkit-column-gap: 1em;
        column-gap: 1em;
        padding: 10px;
      }
    </style>
    <public-elements-service id="ajax" api="{{server}}"
      service="{{service}}"  result="{{result}}" params="{{params}}"
      method="{{method}}"  body="{{body}}" error="{{error}}">
    </public-elements-service>
    <div class="results">
      <template is="dom-repeat" items="{{resultItems}}">
        <public-elements-card card-item="{{item}}" server="{{server}}"
          project-id="{{projectId}}" on-show-item="presentShow">
        </public-elements-card>
      </template>
    </div>
    <public-elements-card-show id="show" on-dismiss-show="dismissShow"></public-elements-card-show>
  </template>
  <script>
    /**
     * `public-elements-list`
     *
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class PublicElementsList extends Polymer.Element {
      static get is() {
        return 'public-elements-list';
      }
      static get properties() {
        return {
          project: {
            type: Object,
          },
          projectId: {
            type: String,
            reflectToAttribute: true,
            observer: 'computeService'
          },
          server: {
            type: String,
            value: ''
          },
          resultItems: [],
          service: {
            observer: 'generateRequest'
          },
          result: {
            observer: 'animateItems'
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
      }

      computeService(projectId) {
        if (!projectId) return;
        this.service = `projects/${projectId}/pubitems`;
      }

      animateItems(result) {
        this.resultItems = result.results;
      }

      generateRequest() {
        if (!this.service) return;
        this.$.ajax.generateRequest();
      }

      presentShow(e) {
        this.$.show.cardItem = e.detail.cardItem;
      }

      dismissShow(e) {
        this.$.show.cardItem = undefined;
      }
    }

    window.customElements.define(PublicElementsList.is, PublicElementsList);
  </script>
</dom-module>
